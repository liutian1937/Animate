(function(){var Unit=(function(){var style=document.documentElement.style,self={};function _each(arr,fn){var i=0,len=arr.length;for(;i<len;i+=1){fn(arr[i])}};var _prefix=(function(){var head=['t','webkitT','MozT','msT','OT'],transform,ret;_each(head,function(val){transform=val+'ransform';if(transform in style){ret=val.substr(0,val.length-1)}});return ret})();self.extend=function(target,obj){for(var i in obj){target[i]=obj[i]}};function _prefixStyle(style){if(_prefix==='')return style;if(!_prefix)return false;return _prefix+style.charAt(0).toUpperCase()+style.substr(1)};self.extend(self,{css3:_prefixStyle('transition'),Transform:_prefixStyle('transform'),Property:_prefixStyle('transitionProperty'),Duration:_prefixStyle('transitionDuration'),TimingFunction:_prefixStyle('transitionTimingFunction')});return self})();var Jwalk=function(elem,params){params=params||null;if(!(this instanceof Jwalk)){return new Jwalk(elem,params)};this.elem=elem||{};this.options={isProcess:false,speeds:{normal:400,fast:200,slow:600},easing:'ease-in',em2px:16};if(params&&typeof params=='object'){for(var key in params){if(this.options.hasOwnProperty(key)){this.options[key]=params[key]}}};this.init();this._closeFn()};Jwalk.prototype={init:function(){var _this=this;this.isAnimate=false;this.data={};this.beginStyle={};this.finalStyle=null;this.played=true},animate:function(){var _this=this,arg=arguments,len=arg.length,params={};if(typeof arg[0]==='object'){params.style=arg[0]}else{return false};params.callback=(function(){return function(data,fn){if(arg[len-1]&&typeof arg[len-1]==='function'){arg[len-1](data)};if(fn&&typeof fn==='function'){fn()}}})();params.speed=(typeof arg[1]==='number')?arg[1]:(function(){return(typeof arg[1]==='string'&&arg[1]in _this.options.speeds)?_this.options.speeds[arg[1]]:_this.options.speeds['normal']})();params.easing=(len>1)?(function(){return(arg[2]&&typeof arg[2]==='string')?arg[2]:(function(){return(typeof arg[1]==='string'&&!(arg[1]in _this.options.speeds))?arg[1]:_this.options.easing})()})():_this.options.easing;params.startStyle={};params.endStyle={};params.pauseStyle={};params.remainderTime=params.speed;if(_this.played){this.stepArray=[];this.newStepArray=null;_this.played=false};_this.stepArray.push(params);_this.current=0;_this.total=_this.stepArray.length;return _this},play:function(replay){var obj;if(this.isAnimate){return false};if(!this.newStepArray){this.newStepArray=this.stepArray.concat()};this.played=true;obj=this.newStepArray[this.current];if(!replay&&this.data.status==='pause'){this._move(obj)}else{this._initStyle(obj,this.finalStyle)}},pause:function(){var obj,elem=this.elem;if(!this.newStepArray||!this.isAnimate||this.data.status==='pause'){return false};this.isAnimate=false;obj=this.newStepArray[this.current];if(obj.remainderTime>0){if(Unit.css3){for(var attr in obj.startStyle){elem.style[attr]=this._getStyle(elem,attr)};clearInterval(this.timer)}else{this._compute(obj,obj.endStyle);clearTimeout(this.timer)}};this.data.status='pause';obj.callback(this.data)},step:function(){var i=0,len,queue;if(arguments.length>1){this.stepActive=false;this.newStepArray=[];queue=Array.prototype.slice.call(arguments,0);for(;i<queue.length;i+=1){if(this.stepArray[queue[i]]){this.newStepArray.push(this.stepArray[queue[i]])}};this.total=this.newStepArray.length}else{this.stepActive=true;this.newStepArray=this.stepArray.concat();this.total=this.newStepArray.length;if(typeof arguments[0]==='number'&&arguments[0]<this.total){this.current=Math.ceil(arguments[0])}};return this},replay:function(){this._initData();this.play(true)},reset:function(){if(this.isAnimate){return false};this._initData();for(var attr in this.elem.style){if(this.elem.style[attr])this.elem.style[attr]=this.beginStyle[attr]}},cycle:function(){this.stepActive=false;this.infinite=true;this.play()},_closeFn:function(){var _this=this;_this.control=(function(){return{process:function(obj){_this.data.result={}for(var attr in obj.style){_this.data.result[attr]=_this._getStyle(_this.elem,attr)};_this.data.status='process';obj.callback(_this.data)},end:function(obj){_this.isAnimate=false;if(_this.stepActive){return false};(_this.current<_this.total-1)?(function(){_this.current+=1;if(_this.data.status!=='pause')_this.play()})():(function(){_this.current=0;if(_this.data.status!=='pause'&&_this.infinite){_this.play()}})()}}})();_this.extend({toggle:function(speed){if(_this.isAnimate){return false};(_this._getStyle(_this.elem,'display')==='none')?_this.show(speed):_this.hide(speed)},hide:function(speed,callback){_this._act({opacity:'0'},speed,function(){_this.elem.style.display='none';if(callback&&typeof callback==='function'){callback()}})},show:function(speed,callback){_this._css({'display':'block','opacity':'0','filter':'alpha(opacity=0)'});_this._act({opacity:'1'},speed,callback)},slideToggle:function(speed){if(_this.isAnimate){return false};(_this._getStyle(_this.elem,'height')==='0px'||_this._getStyle(_this.elem,'display')==='none')?_this.slideDown(speed):_this.slideUp(speed)},slideUp:function(speed,callback){_this._act({height:'1px'},speed,function(){_this.elem.style.display='none';if(callback&&typeof callback==='function'){callback()}})},slideDown:function(speed,callback){this.oHeight=this.oHeight||_this._offset(_this.elem,'Height')+'px';_this._css({'display':'block','overflow':'hidden','height':'0px'});_this._act({height:this.oHeight},speed,callback)}})},_act:function(style,speed,callback){var _this=this;_this.init();speed=speed||0;_this.animate(style,speed,function(data){if(data.status==='end'){if(callback&&typeof callback==='function'){callback()}}}).play()},_initData:function(){this.current=0;this.finalStyle=null;this.stepActive=false;this.infinite=false;this.data.status=''},_initStyle:function(obj,start){var _this=this,val=obj.style,startData,endData,hasProperty,tempData;if(Unit.css3){for(var attr in val){if(start&&start[attr]){startData=start[attr]}else{startData=_this._getStyle(_this.elem,attr)};endData=(val[attr].match(/^[\-|\+]=?/))?(function(){return _this._conversion(startData)+_this._conversion(val[attr])+'px'})():val[attr];if(!_this.beginStyle[attr]){if(attr=='transform'){var s;attr=Unit.Transform;s=_this._getStyle(_this.elem,attr);_this.beginStyle['transform']=s;_this.beginStyle[attr]=s}else{_this.beginStyle[attr]=_this._getStyle(_this.elem,attr)}};obj.startStyle[attr]=startData;obj.endStyle[attr]=endData}}else{for(var attr in val){if(attr==='opacity'){if(start&&start[attr]){startData=start[attr]}else{startData=parseInt((_this._getStyle(_this.elem,'filter')).replace(/[^0-9]/ig,""));startData=(startData||startData===0)?startData:100}processData=val[attr]*100;hasProperty=true}else{tempData=_this._getStyle(_this.elem,attr);if(tempData){hasProperty=true;if(start&&start[attr]){startData=start[attr]}else{tempData=(tempData=='auto')?(function(){if(attr==='width'){return _this.elem.offsetWidth}else if(attr==='height'){return _this.elem.offsetHeight}else{return'0px'}})():tempData;startData=_this._conversion(tempData)}processData=(Math.abs(parseInt(val[attr].replace(/=|px|em/g,'')))>=0)?_this._conversion(val[attr]):val[attr]}else{hasProperty=false}};if(!_this.beginStyle[attr]){_this.beginStyle[attr]=_this._getStyle(_this.elem,attr)};if(hasProperty){endData=(val[attr].match(/^[\-|\+]=?/))?startData+processData:processData;obj.startStyle[attr]=startData;obj.endStyle[attr]=endData}};obj.pauseStyle=obj.startStyle};this.finalStyle=obj.endStyle;_this.data.status='start';obj.callback(_this.data);obj.remainderTime=obj.speed;_this._move(obj)},_move:function(obj){this.isAnimate=true;if(Unit.css3){this._transition(obj,obj.remainderTime,obj.easing);this._css(obj.endStyle)}else{this._run(obj,obj.remainderTime,obj.easing)};this.data.status='process'},_transition:function(obj,speed,easing){var _this=this;_this.elem.style[Unit.Property]='all';_this.elem.style[Unit.Duration]=speed+'ms';_this.elem.style[Unit.TimingFunction]=easing||_this.options.easing;_this.timer=setInterval(function(){_this.isAnimate=true;obj.remainderTime=(obj.remainderTime>0)?obj.remainderTime-50:0;if(_this.options.isProcess){_this.control.process(obj)};if(obj.remainderTime<=0){clearInterval(_this.timer);_this.data.status='end';obj.callback(_this.data,function(){_this.control.end(obj)})}},50)},_css:function(val){for(var attr in val){attr=(attr=='transform')?Unit.Transform:attr;if(attr in this.elem.style){this.elem.style[attr]=val[attr]}}},_compute:function(obj,val){var _this=this,pauseData;for(var attr in val){if(attr==='opacity'){pauseData=parseInt((_this._getStyle(_this.elem,'filter')).replace(/[^0-9]/ig,""))||100}else{pauseData=_this._conversion(_this._getStyle(_this.elem,attr))}obj.pauseStyle[attr]=pauseData}},_run:function(obj,speed,easing){var _this=this,t=0,d=parseInt(speed/10),styles=_this.elem.style,start=obj.pauseStyle,end=obj.endStyle,tween=(Tween[easing])?Tween[easing]:Tween[_this.options.easing];function Run(){if(t<d){t++;_this.isAnimate=true;for(var j in start){if(typeof end[j]==='number'){if(j==='opacity'){styles['filter']='alpha(opacity='+Math.ceil(tween(t,start[j],end[j]-start[j],d))+')'}else{styles[j]=Math.ceil(tween(t,start[j],end[j]-start[j],d))+'px'}}};_this.timer=setTimeout(Run,10);if(_this.options.isProcess){_this.control.process(obj)}}else{for(var k in end){if(typeof end[j]==='number'){if(j==='opacity'){styles['filter']='alpha(opacity='+end['opacity']+')'}else{styles[k]=end[k]+'px'}}else{styles[k]=end[k]}};clearTimeout(_this.timer);_this.data.status='end';obj.callback(_this.data);_this.control.end(obj)};obj.remainderTime=(obj.remainderTime>0)?obj.remainderTime-10:0};Run()},_getStyle:function(elem,attr){return(elem.currentStyle?elem.currentStyle:window.getComputedStyle(elem,null))[attr]},_offset:function(elem,type){var _this=this,method='offset'+type,ret;return(_this._getStyle(elem,'height')==='0px')?(function(){if(_this._getStyle(elem,'display')==='none'){elem.style.display='block';ret=elem[method];elem.style.display='none'}else{ret=elem[method]}return ret})():parseInt(_this._getStyle(_this.elem,'height'))},_conversion:function(num){var _this=this;num=num.replace(/=/g,'');if(num.match(/\%/)){var width=parseInt(_this.elem.parentNode.scrollWidth);return parseInt(num)*width/100};return num.match(/em/)?parseInt(num,10)*_this.options.em2px:parseInt(num,10)},extend:function(obj){if(obj&&typeof obj==='object'){for(var attr in obj){if(!this.hasOwnProperty(attr)){Jwalk.prototype[attr]=obj[attr]}}}}};var Tween={'linear':function(t,b,c,d){return c*t/d+b},'ease-in':function(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b},'ease-out':function(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b},'ease-in-out':function(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b}};window.Jwalk=Jwalk})();